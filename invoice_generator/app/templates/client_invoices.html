{% extends "base.html" %}
{% block title %}Invoice History - {{ client.name }}{% endblock %}
{% block content %}

<h2>Invoice History for {{ client.name }}</h2>
<p>
    <strong>Company:</strong> {{ client.company }} <br>
    <strong>Email:</strong> {{ client.email }} <br>
    <strong>Phone:</strong> {{ client.phone }} <br>
    <strong>Billing Address:</strong> {{ client.billing_address }}
</p>

<hr>

{% if invoices %}
<table class="table table-striped table-bordered table-hover">
    <thead class="table-dark">
        <tr>
            <th>Invoice #</th>
            <th>Issue Date</th>
            <th>Due Date</th>
            <th>Subtotal</th>
            <th>Total</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for invoice in invoices %}
        <tr>
            <td>{{ invoice.invoice_no }}</td>
            <td>{{ invoice.issue_date }}</td>
            <td>{{ invoice.due_date }}</td>
            <td>{{ "%.2f"|format(invoice.subtotal) }}</td>
            <td><strong>{{ "%.2f"|format(invoice.total) }}</strong></td>
            <td>
                <a href="{{ url_for('main.preview_invoice', invoice_id=invoice.id) }}" class="btn btn-sm btn-primary">Preview</a>

                <a href="{{ url_for('main.download_invoice', invoice_id=invoice.id) }}" class="btn btn-sm btn-success">
                    <i class="fa-solid fa-download" id="download1"></i>
                </a>
                <a href="{{ url_for('main.email_invoice', invoice_id=invoice.id) }}" class="btn btn-sm btn-info">
                    <i class="fa-solid fa-envelope"></i>
                </a>

                 <form action="{{ url_for('main.delete_invoice', invoice_id=invoice.id) }}" method="POST" style="display:inline;" 
                    onsubmit="return confirm('Are you sure you want to delete this invoice?');">
                    <button type="submit" class="btn btn-sm btn-danger"><i class="fa-solid fa-trash"></i></button>
                 </form>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
    <div class="alert alert-warning">No invoices found for this client.</div>
{% endif %}

<a href="{{ url_for('main.index') }}" class="btn btn-secondary" id="back">‚Üê Back to Clients</a>

{% endblock %}
